# 10. Задачи оптимального управления. Принцип максимума

## Краткий ответ

**Задачи оптимального управления** (ЗОУ) заключаются в поиске такой стратегии управления динамической системой, которая минимизирует (или максимизирует) заданный критерий качества (функционал) при выполнении ограничений на состояние системы и управление. 

**Принцип максимума Понтрягина** — это фундаментальное необходимое условие оптимальности в таких задачах, утверждающее, что оптимальное управление в каждый момент времени должно максимизировать специальную функцию — гамильтониан, построенный на основе уравнений системы, функционала качества и сопряженных переменных.

## Простыми словами

Представьте, что вы хотите проехать на машине из точки А в точку Б как можно быстрее (или потратив минимум бензина). Это задача оптимального управления.

- Система: Ваша машина.

- Состояние (x(t)): Положение машины, ее скорость в каждый момент времени t.

- Управление (u(t)): То, как вы жмете на газ или тормоз, как поворачиваете руль. У вас есть ограничения: нельзя нажать газ "ниже нуля" или "выше максимума", руль поворачивается на ограниченный угол. Это множество U.

- Правила движения (dx/dt = f(...)): Физические законы, которые говорят, как изменится положение и скорость машины в следующий момент в зависимости от текущего состояния и ваших действий (управления).

- Цель (функционал J): Минимизировать время в пути или расход бензина. Это может включать стоимость всего пути (интеграл L) и, возможно, "штраф" за то, насколько далеко от точки Б вы оказались в конце (терминальная часть φ).

- Граничные условия: Вы стартуете из точки А (x(t₀)=x₀) и хотите приехать в точку Б (x(t₁)=x₁).

Как найти оптимальный способ рулить и жать на педали (u*(t))? Просто "ехать вперед" может быть не лучшим решением, если нужно объезжать препятствия или экономить топливо.

**Принцип максимума Понтрягина** дает нам "проверочное правило", которое должно выполняться для самой лучшей стратегии. Он говорит:

1. Придумай "помощника" — Гамильтониан (H). Эта функция объединяет в себе:

- Мгновенную "стоимость" ваших действий (сколько бензина тратится прямо сейчас — L).

- Как ваши действия влияют на движение машины (f).

- Насколько важно сейчас изменить положение или скорость, чтобы достичь конечной цели наилучшим образом. Эту "важность" или "чувствительность" показывают специальные сопряженные переменные (ψ). Их можно представить как "теневые цены" или "оценки будущего влияния" текущего состояния. Они тоже меняются со временем по своим правилам (сопряженная система).

2. Правило максимума: В каждый момент времени ваша оптимальная стратегия (как нажать на газ/тормоз u*(t)) должна давать максимально возможное значение этому "помощнику"-гамильтониану H, по сравнению со всеми другими возможными действиями, которые вы могли бы предпринять в этот момент (всеми v из допустимого набора U). То есть, оптимальное действие — это то, которое лучше всего балансирует между сиюминутной стоимостью и долгосрочными последствиями (зашитыми в ψ).

3. Правила на концах (условия трансверсальности): Эти "теневые цены" (ψ) в самом конце поездки (t₁) должны соответствовать вашей конечной цели. Например, если вам не важно, с какой скоростью вы приедете в точку Б (лишь бы приехать), то "теневая цена" скорости в конце будет равна нулю. Если же важно приехать точно в точку Б, то на "теневые цены" положения будут наложены другие условия.

В итоге: Принцип максимума не дает сразу готовый ответ, но он превращает сложную задачу поиска функции управления u(t) в задачу решения системы дифференциальных уравнений (для x и ψ) и поиска максимума функции H в каждый момент времени. Это часто позволяет найти кандидатов на оптимальное управление.

## Развернутый ответ

**Задача оптимального управления** (ЗОУ) формулируется следующим образом:

Рассматривается управляемая динамическая система, описываемая системой обыкновенных дифференциальных уравнений (ОДУ):
$$ \frac{dx}{dt} = f(t, x(t), u(t)), \quad t \in [t_0, t_1] $$
где:
*   `x(t) ∈ Rⁿ` — вектор состояния системы в момент времени `t`.
*   `u(t) ∈ U ⊂ Rᵐ` — вектор управления в момент времени `t`. `U` — допустимое множество управлений (часто замкнутое и ограниченное).
*   `f: [t₀, t₁] × Rⁿ × U → Rⁿ` — векторная функция, описывающая динамику системы (предполагается достаточно гладкой).

Заданы граничные условия, например:
*   Начальное состояние: `x(t₀) = x₀`.
*   Конечное состояние может быть фиксированным (`x(t₁) = x₁`), свободным, или принадлежать некоторому целевому множеству `M₁ ⊂ Rⁿ`.

Требуется найти допустимое управление `u*(t)`, `t ∈ [t₀, t₁]`, и соответствующую ему траекторию `x*(t)`, которые минимизируют (или максимизируют) функционал качества (критерий оптимальности):
$$ J[u] = \varphi(x(t_1), t_1) + \int_{t_0}^{t_1} L(t, x(t), u(t)) dt \to \min_{u(\cdot) \in \mathcal{U}} $$
где:
*   `L: [t₀, t₁] × Rⁿ × U → R` — интегральная функция стоимости (например, расход ресурсов, время).
*   `φ: Rⁿ × R → R` — терминальная функция стоимости (например, отклонение от цели).
*   `\mathcal{U}` — класс допустимых управлений (например, кусочно-непрерывные функции со значениями в `U`).

**Принцип максимума Понтрягина**

Л.С. Понтрягин и его ученики сформулировали необходимые условия оптимальности для таких задач. Введем **функцию Гамильтона (гамильтониан)**:
$$ H(t, x, u, \psi) = L(t, x, u) + \psi^T f(t, x, u) $$
где `ψ(t) ∈ Rⁿ` — вектор **сопряженных переменных** (или ко-состояний), удовлетворяющий **сопряженной системе** ОДУ:
$$ \frac{d\psi}{dt} = - \frac{\partial H}{\partial x} = - \left( \frac{\partial L}{\partial x} + \psi^T \frac{\partial f}{\partial x} \right) $$

**Теорема (Принцип максимума Понтрягина):**

Если `u*(t)` — оптимальное управление и `x*(t)` — соответствующая оптимальная траектория для задачи минимизации функционала `J`, то существует ненулевая абсолютно непрерывная вектор-функция `ψ(t)`, удовлетворяющая сопряженной системе, такая что:

1.  **Условие максимума:** Для почти всех `t ∈ [t₀, t₁]` выполняется:
    $$ H(t, x^*(t), u^*(t), \psi(t)) = \max_{v \in U} H(t, x^*(t), v, \psi(t)) $$
    (Для задач максимизации функционала `J` гамильтониан определяется как `H = -L + ψᵀf`, и он также максимизируется).

2.  **Условия трансверсальности:** На концах траектории `t₀` и `t₁` выполняются условия, связывающие `x(t)` и `ψ(t)`. Их вид зависит от граничных условий на `x(t)` и от того, фиксировано ли время `t₁`. Например:
    *   Если `t₁` фиксировано и `x(t₁)` свободно, то `ψ(t₁) = - \frac{\partial \varphi}{\partial x}(x^*(t_1), t_1)`.
    *   Если `t₁` фиксировано и `x(t₁)` фиксировано (`x(t₁) = x₁`), то условие на `ψ(t₁)` отсутствует (оно определяется из решения).
    *   Если `t₁` не фиксировано (свободно) и `x(t₁)` принадлежит гладкому многообразию `M₁`, то `ψ(t₁)` ортогонально касательной плоскости к `M₁` в точке `x^*(t₁)` (плюс дополнительное условие на значение гамильтониана).

3.  **Стационарность гамильтониана:** Если функции `f` и `L` не зависят явно от времени `t`, то гамильтониан `H(x*(t), u*(t), ψ(t))` постоянен вдоль оптимальной траектории. Если при этом время `t₁` не фиксировано, то это постоянное значение равно нулю.

Принцип максимума является **необходимым** условием оптимальности. Если найдено управление, удовлетворяющее этим условиям, оно является "подозреваемым" на оптимальность. Для доказательства **достаточности** требуются дополнительные условия (например, выпуклость). Принцип максимума особенно мощен тем, что он применим даже когда множество `U` замкнуто, что затрудняет применение классического вариационного исчисления.

